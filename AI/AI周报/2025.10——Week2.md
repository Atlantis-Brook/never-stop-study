# **Dify-文生图Agent**
**1) 在工具中安装 Stability**
![image.png](https://atlantis-picgo-core.oss-cn-beijing.aliyuncs.com/picgo/20251014033438-7dac14-20251014033436696.png)
Stability AI是一家领先的开源生成式人工智能公司，专注于开发先进的AI模型，涵盖图像、语言、代码和音频
等领域。其中，最著名的成果之一是Stable Diffusion，这是一种基于文本提示生成图像的模型，能够根据用户输入的文本描述生成高质量的图像。

**2) 配置Stability工具**
使用Stability工具需要填写授权key，Stability 授权key网址：https://platform.stability.ai/account/keys（免费25创建图像额度，后续付费,并非一张图片一个额度，大概一张图片4个额度）。
![image.png](https://atlantis-picgo-core.oss-cn-beijing.aliyuncs.com/picgo/20251014033257-8ec476-20251014033256467.png)

**3) 下载并配置模型供应商**
在文生图过程中，我们需要大模型来撰写生成图片的提示词（Prompt），这里可以使用Deepseek模型进行文生图。

在“设置”->“模型供应商”中安装Deepseek,然后配置key,Deepseek API Key地址:https://platform.deepseek.com/api_keys

![image.png](https://atlantis-picgo-core.oss-cn-beijing.aliyuncs.com/picgo/20251014032929-d16ef6-20251014032928267.png)

**4) 构建Agent**
在“工作室”中“创建空白应用”，选择Agent：
![](https://:0/)![image.png](https://atlantis-picgo-core.oss-cn-beijing.aliyuncs.com/picgo/20251014033734-bff6c4-20251014033732533.png)

![](https://:0/)![image.png](https://atlantis-picgo-core.oss-cn-beijing.aliyuncs.com/picgo/20251014034252-d384e1-20251014034250410.png)


构建Agent调用工具绘图时，注意如下几点：

- 提示词（Prompt）是 Agent 的灵魂，直接影响到输出的效果。通常来说越具体的提示词输出的效果越好，但是过冗长的提示词也会导致一些负面效果。这里指定的提示词为“根据用户的提示，使用工具 stability_text2image 绘画指定内容”，用户每次输入命令的时候，Agent 都会知晓这样的系统级的指令，从而了解要执行用户绘画的任务的时候需要调用一个叫 stability 的工具。
- Llama部分模型可能不可用，可以尝试不同模型。
- 选择模型后，可以配置Agent，包括推理模式（函数调用（Function Calling）和ReAct是两种增强大型语言模型（LLM）能力的推理模式，主要用于提升模型在处理复杂任务时的表现）、迭代次数（如果付费可以设置低一些）、提示词设置。操作如下：

![](https://:0/) ![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/20/1744289013047/3e9baf82308e42cca39ad1dd574a94e9.jpg)
# Dify-旅游助手Agent
**1) 安装工具**
在Dify工具页面中安装“Google”、“网页抓取”、“维基百科”三个工具,安装完成如下：

![](https://:0/) ![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/20/1744289013047/9c15d76e3b2d490bb4fb07439427ef35.jpg)

Google工具需要注册 SerpAPIKey，地址:“https://serpapi.com/manage-api-key”,然后进行配置：

![](https://:0/)![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/20/1744289013047/e2a71870782e4e52ba3a135b8270ed7f.jpg)

- google工具：搭建在线旅游助手需要使用联网的搜索引擎作为参考资料来源，这里将以 Google 作为示例，用户也可以使用其他的搜索引擎（如:必应）。Dify 提供的 Google 工具基于 SerpAPI，因此需要提前进入 SerpAPI 的 API Key 管理页申请 API Key 并粘贴到 Dify - 工具 的对应位置。
- 网页抓取工具：通过google工具搜索相关网页后，需要一个爬虫工具从指定的网页中抓取内容，该工具就是Dify 已提供内置工具，无需额外配置。
- 维基百科工具：Agent如果能准确介绍目的地知识，Wikipedia 是一个比较好知识来源，Dify 也内置了该工具，无需额外配置。

**2) 构建Agent**

Dify中创建空白应用，选择Agent，如下：

![](https://:0/) ![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/20/1744289013047/4a558b5a302146bdaa7be84752ad132e.jpg)

![](https://:0/) ![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/20/1744289013047/4dd964d4b34142ae9cb9efe97c27bbfd.jpg)

Agent回复结果如下：

```
根据收集的信息，以下是北京的详细旅行计划，包括每日行程安排、预算分配和其他建议。

北京5日游旅行计划（预算：10000元）
每日行程安排
第一天：故宫 + 天安门广场 + 王府井大街
上午：游览故宫（门票60元），参观太和殿、乾清宫等主要建筑。
中午：在故宫附近品尝北京烤鸭（人均约150元）。
下午：步行至天安门广场，参观人民英雄纪念碑和毛主席纪念堂（免费）。
晚上：前往王府井大街，体验夜市和小吃（人均约100元）。
第二天：八达岭长城 + 明十三陵
上午：包车或乘坐旅游巴士前往八达岭长城（门票40元，车费约100元/人）。
中午：在长城附近用餐（人均约80元）。
下午：前往明十三陵（门票50元），参观定陵或长陵。
晚上：返回市区，晚餐选择老北京炸酱面（人均约50元）。
第三天：颐和园 + 圆明园
上午：游览颐和园（门票30元），欣赏昆明湖和长廊。
中午：在颐和园附近用餐（人均约80元）。
下午：前往圆明园（门票25元），参观遗址公园。
晚上：晚餐选择涮羊肉（人均约120元）。
第四天：天坛 + 798艺术区 + 三里屯
上午：参观天坛公园（门票15元），体验祈年殿和回音壁。
中午：在天坛附近用餐（人均约60元）。
下午：前往798艺术区（免费），欣赏现代艺术展览。
晚上：在三里屯太古里购物和体验夜生活（人均约150元）。
第五天：胡同游 + 恭王府
上午：骑自行车或步行游览什刹海胡同（免费），体验老北京生活。
中午：在胡同内品尝传统小吃（人均约50元）。
下午：参观恭王府（门票40元），了解清代王府文化。
晚上：晚餐选择京味斋（人均约100元）。

预算分配
门票费用：约300元/人（故宫60 + 长城40 + 十三陵50 + 颐和园30 + 圆明园25 + 天坛15 + 恭王府40）。
餐饮费用：约1500元/人（5天，每天约300元）。
交通费用：约1000元/人（包车、地铁、公交等）。
住宿费用：约4000元/人（5晚，中档酒店约800元/晚）。
其他费用：约1200元/人（购物、小吃、纪念品等）。
总预算：约8000元（剩余2000元可作为备用金）。

其他建议
交通：北京地铁发达，建议购买交通卡（押金20元）。
美食推荐：烤鸭、炸酱面、涮羊肉、豆汁儿、驴打滚。
注意事项：
故宫和长城需提前预约门票。
注意防晒和补水，夏季炎热。
避开节假日，减少人流拥挤。
希望这份计划能帮助您更好地享受北京之旅！
```

**3) 发布Agent**

以上构建完成后，点击发布即可在工作区中使用。

![](https://:0/) ![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/20/1744289013047/c2245120245a47919eabd636b547ec84.jpg)

以上Agent构建注意如下几点：

- 提示词很关键，明确告诉Agent如何使用工具。提示词如下：

```
## 提示词
请根据以下用户输入的信息：
- 目的地：{{destination}}
- 旅游天数：{{days}}
- 旅游预算：{{budget}}

使用以下工具完成任务：
1. **google_search**：搜索目的地的主要景点和酒店信息。
2. **webscraper**：提取上述搜索结果中有用的信息，包括景点描述、开放时间、门票价格、酒店名称、位置、价格和用户评价等。
3. **wikipedia_search**：获取目的地的背景信息、历史和文化等。

最终，生成一个详细的旅行计划，包括：
- 每日行程安排：列出每天的活动、参观的景点和住宿安排。
- 预算分配：估算每日花费，确保总预算控制在旅游预算内。
- 其他建议：如当地美食推荐、交通方式等。

请以清晰、结构化的格式呈现上述信息，确保内容准确且实用。
```

- 变量可以修改为中文及类型。
- 工具中依次选择各个工具，鼠标悬浮到对应工具上可以看到相应的工具名称，便于Agent识别。
- 可以通过页面下方“管理”设置Agent对话的开场白。
